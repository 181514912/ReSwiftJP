#!/bin/bash

update_jazzy() {
  REPO=$1
  BRANCH=$2
  DEST=vendor/jazzy

  if [ -d "$DEST" ]; then
    git -C "$DEST" pull origin "$BRANCH"
  else
    git clone --depth 1 --branch "$BRANCH" "$REPO" "$DEST"
  fi

  bundle install --gemfile="$DEST/Gemfile"
}

generate_docs_for_branch() {
  GITHUB=$1
  REPO="$GITHUB.git"
  BRANCH=$2
  URL=$3
  NAME=$4
  JAZZY=./vendor/jazzy/bin/jazzy

  if [ -d "$NAME" ]; then
    git -C "$NAME" pull origin "$BRANCH"
  else
    git clone --depth 1 --branch "$BRANCH" "$REPO" "$NAME"
  fi

  $JAZZY \
    --config .jazzy.json \
    --clean \
    --output "$BRANCH" \
    --module-version "$BRANCH" \
    --dash_url "$URL/$BRANCH/docsets/$NAME.xml" \
    --root-url "$URL/$BRANCH/" \
    --github-file-prefix "$GITHUB/tree/$BRANCH" \
    --github_url "$GITHUB"
}
